<div class="container">
    <div class="row justify-content-center p-fileupload-buttonbar">
        <div class="col-11">
            <p-fileUpload styleClass="shadow-md" name="demo[]" customUpload="true" maxFileSize="1000000" fileLimit="1" (uploadHandler)="onUpload($event)" (onClear)="onCancel()" chooseLabel="Browse">
                <ng-template pTemplate="toolbar">
                    <div *ngIf="cartasEncontradas.length > 0" class="float-right">
                        <button pButton label="Guardar en album" icon="pi pi-save" (click)="guardarCartasEnAlbum()"></button>
                        <button pButton label="Crear album" icon="pi pi-plus" class="p-button-success" (click)="crearAlbum()"></button>
                    </div>
                </ng-template>
                
                <ng-template let-file pTemplate="file">
                    <div class="row justify-content-center">
                        <div class="col-9">
                            <span>{{file.name}}</span>
                            <span class="float-right">{{file.size}} bytes</span>
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="content" let-files>
                    <div *ngIf="files.length==0" class="row justify-content-center">
                        <span>Pulsa <em>Browse</em> para comenzar a importar un fichero.</span>
                    </div>
                </ng-template>
            </p-fileUpload>
        </div>
    </div>

    <div *ngIf="cartasEncontradas.length > 0" class="row">
        <div class="col-12">
            <div class="card shadow mt-5" style="border-radius:6px;">
                <p-table [value]="cartasEncontradas" responsiveLayout="scroll" style="border-radius:6px;">
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="padding-left: 28px;">Nombre</th>
                            <th>Set</th>
                            <th>Rareza</th>
                            <th>Imagen HD</th>
                            <th>Cantidad</th>
                            <th>
                                <div class="float-right">
                                    <button pButton label="Añadir" icon="pi pi-plus" class="p-button-sm p-button-text p-button-secondary" (click)="addItem()"></button>
                                </div>
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-carta>
                        <!-- IF CARTA -->
                        <tr *ngIf="carta.data">
                            <td><button class="btn btn-link" [lightbox]="cartasEncontradas.indexOf(carta)">{{carta.data.name}}</button></td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <button pButton class="p-button-text p-button-rounded p-button-secondary" (click)="elegirVersionCarta(carta)">
                                        <span [innerHTML]="carta.data.set | edicion:'26px' | async"></span>
                                    </button>
                                    <p-dropdown #edicion styleClass="open-me" class="open-me" *ngIf="true || edicionSelectorOpen" [options]="edicionSelectorData" [(ngModel)]="edicionSelectorSelected" optionLabel="edicion.name" [filter]="true" filterBy="edicion.name" [showClear]="true" placeholder="Selecciona una edicion">
                                        <ng-template pTemplate="selectedItem">
                                            <div class="row" *ngIf="edicionSelectorSelected">
                                                <span class="col-2" [innerHTML]="edicionSelectorSelected.code | edicion:'26px' | async"></span>
                                                <div class="col-10" style="overflow: hidden;">{{edicionSelectorSelected.name}}</div>
                                            </div>
                                        </ng-template>
                                        <ng-template let-item pTemplate="item">
                                            <div class="row w-100">
                                                <span class="col-2" [innerHTML]="item.edicion.code | edicion:'26px' | async"></span>
                                                <div class="col-7" style="overflow: hidden; text-overflow: ellipsis;">{{item.edicion.name}}</div>
                                                <div class="col-3" [ngClass]="getCssRarity(item.rareza)">{{item.rareza}}</div>
                                            </div>
                                        </ng-template>
                                    </p-dropdown>
                                </div>

                            </td>
                            <td [ngClass]="getCssRarity(carta.data.rarity)">{{carta.data.rarity}}</td>
                            <td>
                                <i *ngIf="carta.fullResImg" class='pi pi-check'></i>
                                <i *ngIf="!carta.fullResImg" class='pi pi-times'></i>
                                <!-- {{ data.fullResImg ? 'Sí' : 'No' }} -->
                            </td>
                            <td>
                                <!-- CANTIDAD -->
                                <div class="input-group">
                                    <input type="number" class="form-control" [(ngModel)]="carta.amount" />
                                    <!-- <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button" (click)="restarCantidad(carta)">
                                            <i class="pi pi-minus"></i>
                                        </button>
                                        <button class="btn btn-outline-secondary" type="button" (click)="sumarCantidad(carta)">
                                            <i class="pi pi-plus"></i>
                                        </button>
                                    </div> -->
                                </div>
                            </td>
                            <td>
                                <div class="float-right">
                                    <button pButton type="button" icon="pi pi-pencil" class="p-button-rounded p-button-text m-1" (click)="editarItem(carta)"></button>
                                    <button pButton type="button" icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-text m-1" (click)="eliminarItem(carta)"></button>
                                </div>
                            </td>
                        </tr>
                        <!-- IF NO CARTA -->
                        <tr *ngIf="!carta.data" class="text-danger" style="background-color: #FFCCCC;">
                            <td>
                                <i class="pi pi-exclamation-circle m-2"></i> {{carta.textoBuscado}}
                            </td>
                            <td colspan="3" class="text-center">
                                Carta no encontrada &nbsp;
                            </td>
                            <td>
                                <button class="btn btn-danger" (click)="editarItem(carta)">editar</button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>
</div>